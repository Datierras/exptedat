<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gestión de Expedientes</title>
  <link rel="stylesheet" href="./style.css" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Libs (solo cuando se usan, no bloquea el login): -->
  <script defer src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <!-- Pantalla de Login -->
  <section id="loginScreen" class="screen login">
    <div class="card auth-card">
      <h1 class="title">Iniciar sesión</h1>
      <p class="muted">Acceso con email y contraseña</p>
      <div class="field">
        <label for="loginEmail">Email</label>
        <input id="loginEmail" type="email" placeholder="usuario@dominio.com" autocomplete="username" />
      </div>
      <div class="field">
        <label for="loginPass">Contraseña</label>
        <input id="loginPass" type="password" placeholder="********" autocomplete="current-password" />
      </div>
      <button id="btnLogin" class="btn btn-primary w-full">Entrar</button>
      <div id="loginMsg" class="msg"></div>
    </div>
  </section>

  <!-- App -->
  <main id="appRoot" class="app hidden">
    <header class="topbar card glass">
      <div class="brand">
        <h1>Gestión de Expedientes</h1>
        <p class="muted">Cargar, etiquar y buscar expedientes</p>
      </div>
      <div class="actions">
        <button id="btnConfig" class="btn">⚙️</button>
        <button id="btnLogout" class="btn btn-secondary">Salir</button>
      </div>
    </header>

    <nav class="tabs card glass">
      <button id="tabBtnCarga"   class="pill active">CARGA</button>
      <button id="tabBtnBusqueda" class="pill">BÚSQUEDA</button>
    </nav>

    <!-- Panel: CARGA -->
    <section id="panelCarga" class="panel card glass">
      <h2 class="panel-title">Cargar expediente</h2>
      <div class="grid-2">
        <div class="field"><label for="inCodigo">Código</label><input id="inCodigo" type="text" placeholder="4078" /></div>
        <div class="field"><label for="inNumero">Número</label><input id="inNumero" type="text" placeholder="123456" /></div>
        <div class="field"><label for="inLetra">Letra</label><input id="inLetra" type="text" maxlength="1" placeholder="I" /></div>
        <div class="field"><label for="inAnio">Año</label><input id="inAnio" type="text" placeholder="2025" /></div>
      </div>
      <div class="field"><label for="inExtracto">Extracto</label><input id="inExtracto" type="text" placeholder="Descripción breve" /></div>

      <details class="details">
        <summary>Nomenclatura</summary>
        <div class="grid-2">
          <div class="field"><label for="inCirc">Circunscripción</label><input id="inCirc" type="text" /></div>
          <div class="field"><label for="inSec">Sección</label><input id="inSec" type="text" /></div>
          <div class="field"><label for="inChacra">Chacra</label><input id="inChacra" type="text" /></div>
          <div class="field"><label for="inLch">L. CH.</label><input id="inLch" type="text" /></div>
          <div class="field"><label for="inQuinta">Quinta</label><input id="inQuinta" type="text" /></div>
          <div class="field"><label for="inLq">L. Qt.</label><input id="inLq" type="text" /></div>
          <div class="field"><label for="inFraccion">Fracción</label><input id="inFraccion" type="text" /></div>
          <div class="field"><label for="inLf">L. Fr.</label><input id="inLf" type="text" /></div>
          <div class="field"><label for="inManzana">Manzana</label><input id="inManzana" type="text" /></div>
          <div class="field"><label for="inLm">L. Mz.</label><input id="inLm" type="text" /></div>
          <div class="field"><label for="inParcela">Parcela</label><input id="inParcela" type="text" /></div>
          <div class="field"><label for="inLp">L. Pc.</label><input id="inLp" type="text" /></div>
        </div>
        <div class="grid-2">
          <div class="field"><label for="inProv">Partida Provincial</label><input id="inProv" type="text" /></div>
          <div class="field"><label for="inMun">Partida Municipal</label><input id="inMun" type="text" /></div>
        </div>
      </details>

      <div class="row gap">
        <button id="btnGenerarCodigo" class="btn btn-soft">Generar etiqueta</button>
        <button id="btnEscaner" class="btn btn-soft">Escanear</button>
        <button id="btnGuardar" class="btn btn-primary">Guardar expediente</button>
        <div id="msgGuardar" class="msg"></div>
      </div>

      <!-- Etiqueta generada -->
      <div id="etiquetaBox" class="card sub glass hidden">
        <h3>Etiqueta</h3>
        <svg id="barcode" role="img" aria-label="Código de barras"></svg>
        <div class="row gap">
          <button id="btnImprimirEtiqueta" class="btn">Imprimir</button>
          <button id="btnPdfEtiqueta" class="btn">PDF</button>
        </div>
      </div>
    </section>

    <!-- Panel: BÚSQUEDA -->
    <section id="panelBusqueda" class="panel card glass hidden">
      <h2 class="panel-title">Búsqueda</h2>
      <div class="grid-3">
        <div class="field"><label for="bId">ID / Código-Numero-Letra-Año</label><input id="bId" type="text" placeholder="4078-123456-I-2025" /></div>
        <div class="field"><label for="bExtracto">Extracto</label><input id="bExtracto" type="text" placeholder="Palabras clave" /></div>
        <div class="field"><label for="bArea">Área</label><input id="bArea" type="text" placeholder="Coordinación..." /></div>
      </div>
      <div class="row gap">
        <button id="btnBuscar" class="btn btn-primary">Buscar</button>
        <button id="btnLimpiar" class="btn btn-secondary">Limpiar</button>
      </div>
      <div id="resultados" class="results"></div>
    </section>
  </main>

  <!-- Modal Configuración -->
  <div id="modalConfig" class="modal hidden">
    <div class="backdrop" data-close-modal="modalConfig"></div>
    <div class="modal-card card glass">
      <div class="modal-head">
        <h3>Configuración</h3>
        <button class="modal-close" data-close-modal="modalConfig">✕</button>
      </div>
      <div class="modal-body">
        <div class="field">
          <label for="confApodo">Apodo para registrar movimientos</label>
          <input id="confApodo" type="text" placeholder="12345 Apellido" />
          <p class="hint">Se mostrará como autor en tus nuevos movimientos.</p>
        </div>
        <div id="msgApodo" class="msg"></div>
      </div>
      <div class="modal-foot">
        <button id="btnGuardarApodo" class="btn btn-primary">Guardar</button>
        <button class="btn btn-secondary" data-close-modal="modalConfig">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal Escaner -->
  <div id="modalEscaner" class="modal hidden">
    <div class="backdrop" data-close-modal="modalEscaner"></div>
    <div class="modal-card card glass">
      <div class="modal-head">
        <h3>Escáner de código</h3>
        <button class="modal-close" data-close-modal="modalEscaner">✕</button>
      </div>
      <div class="modal-body">
        <div class="field">
          <label for="selCamaras">Cámara</label>
          <select id="selCamaras"></select>
        </div>
        <video id="previewVideo" playsinline muted class="video"></video>
        <p class="hint">Apuntá el código al centro. En algunos dispositivos la linterna puede no estar disponible.</p>
        <div id="msgEscaner" class="msg"></div>
      </div>
      <div class="modal-foot">
        <button class="btn btn-secondary" data-close-modal="modalEscaner">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Config Firebase -->
  <script type="module" src="./config.js"></script>
  <!-- App -->
  <script type="module" src="./app.js"></script>
</body>
</html>
